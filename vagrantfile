#
# VARIABLE DEFAULT VALUES
#
vendor = "vemt"  # for no vendor specific configs leave it as "-", for the default vendor use "default"

#
# READ VENDOR SPECIFIC VALUES
#
vendor_folder = "./provisioning/vendor/#{vendor}/vagrantfile.rb"
if FileTest.exists?("#{vendor_folder}")
    vendor_vagrantfile = File.read "#{vendor_folder}"
    eval vendor_vagrantfile
end

#
#
#
Vagrant.configure("2") do |config|

    # ==================================================================
    #
    # PROVIDER CONFIGS
    #
    # ------------------------------------------------------------------

    config.vm.provider :virtualbox do |vb|
        # To show the VirtualBox gui:
        # vb.gui = true

        # Use VBoxManage to customize the VM. For example to change memory:
        vb.customize ["modifyvm", :id, "--memory", "#{memory}"]
        # vb.customize ["modifyvm", "b8621fc6-0ec8-43bc-b38d-308d22ca64a6", "--memory", "1024"]
    end

    # ==================================================================
    #
    # APP
    #
    # ------------------------------------------------------------------

    config.vm.define :app do |app|
        app.vm.box      = "CentOS-6.4-i386-v20130427"
        app.vm.box_url  = "#{app_box_url}"
        app.vm.hostname = "app.#{environment}.#{hostname_ext}"
        app.ssh.timeout = 300

        app.vm.network :private_network, ip: "192.168.1.11"
        app.vm.network :forwarded_port, guest: 21, host: 1121, auto_correct: true
        app.vm.network :forwarded_port, guest: 22, host: 1122, auto_correct: true
        app.vm.network :forwarded_port, guest: 80, host: 1180, auto_correct: true
        app.vm.network :forwarded_port, guest: 8080, host: 118080, auto_correct: true
        app.vm.provision :shell do |s|
            s.path = "provisioning.sh"
            s.args = "-b app -e #{environment} -g #{gituser} -v #{vendor}"
        end

        # This is here for reference only
        # This does not allow apache to start up because of www folder caracteristics (vagrant share)
        # app.vm.synced_folder "~/public_html/vemt/", "/opt/www"
    end

    # ==================================================================
    #
    # DB
    #
    # ------------------------------------------------------------------

    config.vm.define :db do |db|
        db.vm.box      = "CentOS-6.4-i386-v20130427"
        db.vm.box_url  = "#{db_box_url}"
        db.vm.hostname = "db.#{environment}.#{hostname_ext}"
        db.ssh.timeout = 300

        db.vm.network :private_network, ip: "192.168.1.12"
        db.vm.network :forwarded_port, guest: 21, host: 1221, auto_correct: true
        db.vm.network :forwarded_port, guest: 22, host: 1222, auto_correct: true
        db.vm.network :forwarded_port, guest: 80, host: 1280, auto_correct: true
        db.vm.network :forwarded_port, guest: 8080, host: 128080, auto_correct: true
        db.vm.provision :shell do |s|
            s.path = "provisioning.sh"
            s.args = "-b db -e #{environment} -g #{gituser} -v #{vendor}"
        end
    end

    # ==================================================================
    #
    # REPORTS
    #
    # ------------------------------------------------------------------

    config.vm.define :reports do |reports|
        reports.vm.box      = "CentOS-6.4-i386-v20130427"
        reports.vm.box_url  = "#{reports_box_url}"
        reports.vm.hostname = "reports.#{environment}.#{hostname_ext}"
        reports.ssh.timeout = 300

        reports.vm.network :private_network, ip: "192.168.1.13"
        reports.vm.network :forwarded_port, guest: 21, host: 1321, auto_correct: true
        reports.vm.network :forwarded_port, guest: 22, host: 1322, auto_correct: true
        reports.vm.network :forwarded_port, guest: 80, host: 1380, auto_correct: true
        reports.vm.network :forwarded_port, guest: 8080, host: 138080, auto_correct: true
        reports.vm.provision :shell do |s|
            s.path = "provisioning.sh"
            s.args = "-b reports -e #{environment} -g #{gituser} -v #{vendor}"
        end
    end

    # ==================================================================
    #
    # MAILINGS
    #
    # ------------------------------------------------------------------

    config.vm.define :mailings do |mailings|
        mailings.vm.box      = "CentOS-6.4-i386-v20130427"
        mailings.vm.box_url  = "#{mailings_box_url}"
        mailings.vm.hostname = "mailings.#{environment}.#{hostname_ext}"
        mailings.ssh.timeout = 300

        mailings.vm.network :private_network, ip: "192.168.1.14"
        mailings.vm.network :forwarded_port, guest: 21, host: 1421, auto_correct: true
        mailings.vm.network :forwarded_port, guest: 22, host: 1422, auto_correct: true
        mailings.vm.network :forwarded_port, guest: 80, host: 1480, auto_correct: true
        mailings.vm.network :forwarded_port, guest: 8080, host: 148080, auto_correct: true
        mailings.vm.provision :shell do |s|
            s.path = "provisioning.sh"
            s.args = "-b mailings -e #{environment} -g #{gituser} -v #{vendor}"
        end
    end

end
